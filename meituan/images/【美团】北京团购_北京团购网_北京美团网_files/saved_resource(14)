M.add("w-slider",function(e){var t=e.Lang.isFunction,n=e.UA,i=e.mt.util,r="mt-slider",s={triggerContainer:r+"-trigger-container",triggerContainerEx:r+"-trigger-container-ex",trigger:r+"-trigger",currentTrigger:r+"-current-trigger",sheetContainer:r+"-sheet-container",sheet:r+"-sheet",currentSheet:r+"-current-sheet",previous:r+"-previous",next:r+"-next"},a=e.config["w-slider"]||{},o=function(){o.superclass.constructor.apply(this,arguments)};o.NAME="Slider",o.CSS_PREFIX=r,o.HTML_PARSER={sheetContainer:"> ."+s.sheetContainer,triggerContainer:"> ."+s.triggerContainer,triggerContainerEx:"> ."+s.triggerContainerEx,previous:"> .previous",next:"> .next"},o.TEMPLATE={trigger:'<a href="javascript:;" hidefocus="true" class="{previous}"></a><a href="javascript:;" hidefocus="true" class="{next}"></a>',statusBar:"<ul></ul>"},o.CLASS_NAME=s,o.ATTRS={sheetContainer:{value:null,setter:function(t){return e.one(t)}},triggerContainerEx:{value:null,setter:function(t){return e.one(t)}},triggerContainer:{value:null,setter:function(t){return e.one(t)}},pnContainer:{value:null,setter:function(t){return e.one(t)}},previous:{value:null,setter:function(t){return e.one(t)}},next:{value:null,setter:function(t){return e.one(t)}},autoPlay:{value:!0},activeStop:{value:!0},pnAutoHide:{value:!1},interval:{value:5e3},effect:{value:"slideLeft"},duration:{value:300},triggerEvent:{value:"click"},index:{value:0},hoverOpacity:{value:n.ie<=8&&n.ie>0?1:.6},lazyloading:{value:!1}},e.extend(o,e.Widget,{initializer:function(){var e=this,t=e.get("sheetContainer"),n=t&&t.all("> li");if(n&&n.isEmpty())throw new Error(o.NAME+": 没有内容页");e._timer=null,e._handles={},e._pause=!1,e._nlSheet=n},destructor:function(){i.detachHandle(this._handles),this.get("boundingBox").remove(!0)},_beforeRenderUI:function(){var e=this.get("index"),t=this._nlSheet,n=t.item(e);this._updateImgs(n),n.show(),"slideFadeIn"===this.get("effect")&&(t.setStyle("opacity",0),n.setStyle("opacity",1))},_afterRenderUI:function(){var e=this._nlSheet,t=(this.get("index")+1)%e.size();this._updateImgs(e.item(t))},_updateImgs:function(e){var t="data-src";this.get("lazyloading")&&e.all("img[data-src]").each(function(e){a.cssLazyClass&&e.on("load",function(){e.removeClass(a.cssLazyClass)}),e.set("src",e.getAttribute(t)),e.removeAttribute(t)})},renderUI:function(){this._beforeRenderUI(),this._renderTriggerContainer(),this._modifySheetContainer(),this._renderPreNextContainer(),this._anim=this._getAnim(),this._afterRenderUI()},_renderTriggerContainer:function(){function e(){for(var e="<li></li>",t=[],n=0;n<i.size();n++)t.push(e);return t.join("")}var t=this.get("triggerContainer"),n=this.get("triggerContainerEx"),i=this._nlSheet,r=this.get("index"),a=0,o=null;t?(a=t.all("> li").size(),i.size()!==a&&t.setHTML(e()),"none"===t.getStyle("display")&&t.show(),o=t.all("> li"),o.addClass(s.trigger),o.item(r).addClass(s.currentTrigger),t.addClass(s.triggerContainer)):n&&(n.one(".total").setHTML(i.size()),n.one(".current").setHTML(1),"none"===n.getStyle("display")&&n.show())},_modifySheetContainer:function(){var e=this.get("sheetContainer"),t=this._nlSheet,n=this.get("index");e.addClass(s.sheetContainer),t.addClass(s.sheet),t.item(n).addClass(s.currentSheet),t.each(function(e,t){t!==n&&e.hide()})},_renderPreNextContainer:function(){var e=this.get("previous"),t=this.get("pnAutoHide"),n=this.get("next");n||e?t&&(e&&(e.setStyle("opacity",0),e.show()),n&&(n.setStyle("opacity",0),n.show())):this.buildPreNext()},buildPreNext:function(){var t,n,i,r=this.get("pnContainer"),a=this.get("pnAutoHide");r&&(i=e.Node.create(e.Lang.sub(o.TEMPLATE.trigger,s)),r.append(i),this.set("previous",t=r.one("."+s.previous)),this.set("next",n=r.one("."+s.next)),a&&(t.setStyle("opacity",0),n.setStyle("opacity",0)))},bindUI:function(){var e=this,t=e.get("triggerContainer"),n=e.get("sheetContainer"),i=this.get("pnAutoHide"),r=t&&t.all("> li");e.isFromNavigator=!1,e.after("indexChange",this._defIndexChangeFn,this),n.on({mouseover:function(){e.pause()},mouseout:function(){e.reset()}}),r&&r.each(function(t,n){t.on(e.get("triggerEvent"),function(t){t.halt(),e.set("index",n),e._activeStop=!0,e.reset()})}),this.lrBtnClickHandler(),i&&this.handleLrBtnHide()},syncUI:function(){this.get("autoPlay")&&this.play()},lrBtnClickHandler:function(){var e=this.get("previous"),t=this.get("next"),n=this;e&&e.on("click",function(e){e.halt(),n.showPrevious(),n._activeStop=!0,n.reset()}),t&&t.on("click",function(e){e.halt(),n.showNext(),n._activeStop=!0,n.reset()})},handleLrBtnHide:function(){function e(){s.setStyle("opacity",l),a.setStyle("opacity",l)}function t(e){e.pageX>i.left&&e.pageX<i.left+i.width&&e.pageY>i.top&&e.pageY<i.top+i.height||(s.setStyle("opacity",0),a.setStyle("opacity",0))}var n,i,r,s=this.get("previous"),a=this.get("next"),o=this,l=this.get("hoverOpacity");a&&s&&(r={mouseover:e,mouseout:t},n=o.get("sheetContainer"),i=n.get("region"),n.delegate(r,".mt-slider-sheet"),a.on(r),s.on(r))},_defIndexChangeFn:function(e){var t=this,n=t.get("triggerContainer"),i=t.get("triggerContainerEx"),r=n&&n.all("> li"),a=t._nlSheet,o=a.size(),l=e.prevVal,u=e.newVal;r&&e.newVal>=r.size()||(t._updateImgs(a.item(e.newVal)),r&&(r.item(l).removeClass(s.currentTrigger),r.item(u).addClass(s.currentTrigger)),i&&i.one(".current").setHTML(u+1),t.isFromNavigator||(2===o?t._dir=!0:Math.abs(u-l)===o-1?t._dir=l>u:t._dir=u>l),t._anim(a.item(l),a.item(u)))},_getAnim:function(){var n,i,r,s,a,l,u,g,h=this,c=h.get("sheetContainer"),d=h.get("effect"),f=h.get("duration")/1e3,p=null,v=null,m=null,_=!0;switch(d){case"slideHorizontal":case"slideLeft":n=parseInt(c.getStyle("width"),10),i={left:n},l={left:-n},g={left:0},v={nextStyles:{left:n},currentAnimTo:{left:-n}},m={nextStyles:{left:-n},currentAnimTo:{left:n}};break;case"slideVertical":case"slideUp":n=parseInt(c.getStyle("height"),10),i={top:n},l={top:-n},g={top:0},v={nextStyles:{top:n},currentAnimTo:{top:-n}},m={nextStyles:{top:-n},currentAnimTo:{top:n}};break;case"slideFadeIn":l={opacity:0},g={opacity:1};break;default:throw new Error(o.NAME+": 切换效果类型不存在")}return r=new e.Anim({from:a||{},to:l||{},duration:f,easing:e.Easing.easeBoth}),s=new e.Anim({from:u||{},to:g||{},duration:f,easing:e.Easing.easeBoth}),p=m||null,function(e,n,a){p&&h._dir!==_&&(_=h._dir,i=p.nextStyles,r.set("to",p.currentAnimTo),p=p===v?m:v),h.isFromNavigator=!1,r.stop(!0),s.stop(!0),i&&n.setStyles(i),n.show(),r.set("node",e),r.detach("end"),r.on("end",function(){e.hide()}),s.set("node",n),s.detach("end"),s.on("end",function(){t(a)&&a(),h.fire("endAnim",{index:h.get("index")})}),r.run(),s.run()}},showPrevious:function(){var e=this,t=e.get("index"),n=e._nlSheet.size(),i=0===t?n-1:(t-1)%n;e.isFromNavigator=!0,e._dir=!1,e.set("index",i)},showNext:function(){var e=this,t=e.get("index"),n=e._nlSheet.size(),i=(t+2)%n,r=(t+1)%n;e.isFromNavigator=!0,e._dir=!0,e.set("index",r),e._updateImgs(this._nlSheet.item(i))},pause:function(){this._pause=!0},reset:function(){var e=this;if(e._pause=!1,e.get("autoPlay")){if(window.clearTimeout(e._timer),e.get("activeStop")&&e._activeStop)return;e.play()}},isPause:function(){return this._pause},play:function(){var e=this;e._timer=window.setTimeout(function(){e.isPause()||(e.showNext(),e.play())},e.get("interval"))}}),e.mt.widget.Slider=o},"1.0.0",{requires:["mt-base","anim","widget","node"],skinnable:!0});
;